<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆåº“ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
        }
        
        header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 20px;
            text-align: center;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 600;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* å…¬å‘Šæ  */
        .announcement {
            background-color: #fff;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .announcement-text {
            font-size: 16px;
            color: #333;
            font-weight: 500;
            flex: 1;
            text-align: center;
        }
        
        .edit-announcement {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }
        
        .edit-announcement:hover {
            background-color: #2980b9;
        }
        
        /* æ‹–æ‹½æ’åºæ§åˆ¶åŒºåŸŸ */
        .drag-sort-controls {
            background-color: #fff;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .drag-sort-controls h3 {
            margin-bottom: 10px;
            color: #333;
            font-size: 18px;
        }
        
        .drag-sort-controls p {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .drag-sort-controls button {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }
        
        .drag-sort-controls button:hover {
            background-color: #c0392b;
        }
        
        /* æ¸¸æˆç®¡ç†é¢æ¿ */
        .admin-panel {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .admin-panel h2 {
            margin-bottom: 20px;
            color: #333;
            font-size: 22px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-size: 14px;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
        }
        
        .form-group input,
        .form-group select {
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            border-color: #3498db;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-group input {
            width: auto;
            margin: 0;
        }
        
        .checkbox-group label {
            margin: 0;
            font-weight: normal;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .btn-primary {
            background-color: #27ae60;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #229954;
        }
        
        .btn-secondary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #2980b9;
        }
        
        .btn-warning {
            background-color: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
        }
        
        /* çŠ¶æ€æç¤º */
        #status {
            text-align: center;
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            font-size: 14px;
            color: #666;
        }
        
        /* æ¸¸æˆåˆ—è¡¨ */
        .games-section {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .games-section h2 {
            margin-bottom: 20px;
            color: #333;
            font-size: 22px;
        }
        
        .games-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }
        
        /* æ¸¸æˆå¡ç‰‡ */
        .game-card {
            background-color: #fff;
            border: 2px dashed #ddd;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
            padding: 10px;
            cursor: move;
        }
        
        .game-card:hover {
            border-color: #3498db;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .game-card.dragging {
            opacity: 0.5;
            border-color: #3498db;
        }
        
        .game-card.drag-over {
            border-color: #27ae60;
            background-color: #f8f9fa;
        }
        
        .game-image-container {
            position: relative;
            height: 160px;
            overflow: hidden;
            background-color: #f5f5f5;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .game-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .top-left-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background-color: #e74c3c;
            color: white;
            font-size: 12px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
            z-index: 10;
        }
        
        .new-release-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: #e67e22;
            color: white;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            z-index: 10;
        }
        
        .game-tag {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background-color: rgba(52, 152, 219, 0.9);
            color: white;
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 12px;
            z-index: 10;
        }
        
        .game-info {
            padding: 5px 0;
        }
        
        .game-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .game-format {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-edit {
            background-color: #f39c12;
            color: white;
            flex: 1;
            font-size: 13px;
            padding: 8px;
        }
        
        .btn-edit:hover {
            background-color: #e67e22;
        }
        
        .btn-delete {
            background-color: #e74c3c;
            color: white;
            flex: 1;
            font-size: 13px;
            padding: 8px;
        }
        
        .btn-delete:hover {
            background-color: #c0392b;
        }
        
        /* ç¼–è¾‘å¼¹çª— */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-header h3 {
            font-size: 20px;
            color: #333;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            color: #666;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }
        
        .close-modal:hover {
            background-color: #f5f5f5;
        }
        
        /* å¯¼å‡ºæŒ‰é’® */
        .export-section {
            text-align: center;
            margin: 30px 0;
        }
        
        .btn-export {
            background-color: #9b59b6;
            color: white;
            padding: 15px 30px;
            font-size: 16px;
        }
        
        .btn-export:hover {
            background-color: #8e44ad;
        }
        
        /* è¿”å›æŒ‰é’® */
        .back-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #2c3e50;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 100;
        }
        
        .back-button:hover {
            background-color: #34495e;
            transform: scale(1.1);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .form-actions .btn {
                width: 100%;
            }
            
            .games-container {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                padding: 20px;
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ® æ¸¸æˆåº“ç®¡ç†ç³»ç»Ÿ</h1>
        </header>
        
        <!-- å…¬å‘Šæ  -->
        <div class="announcement">
            <span id="announcementText" class="announcement-text">ğŸ‰ è¯·æŒ‰ä¸‹å•å¥—é¤æ¸¸æˆæ•°é‡æŒ‰éœ€é€‰æ‹©ï¼Œæ¸¸æˆåæœŸå¯10å…ƒä¸€æ¬¡æ›´æ¢å“¦~</span>
            <button class="edit-announcement" onclick="editAnnouncement()">âœï¸ ç¼–è¾‘å…¬å‘Š</button>
        </div>
        
        <!-- æ‹–æ‹½æ’åºæ§åˆ¶åŒºåŸŸ -->
        <div class="drag-sort-controls">
            <h3>ğŸ¯ æ‹–æ‹½æ’åºåŠŸèƒ½</h3>
            <p>ğŸ’¡ æç¤ºï¼šåœ¨ä¸‹æ–¹æ¸¸æˆåˆ—è¡¨ä¸­ï¼Œç›´æ¥æ‹–æ‹½å¡ç‰‡å³å¯è°ƒæ•´é¡ºåºã€‚æ’åºç»“æœä¼šè‡ªåŠ¨ä¿å­˜ã€‚</p>
            <button onclick="clearDragSort()">ğŸ—‘ï¸ æ¸…é™¤æ‹–æ‹½æ’åº</button>
        </div>
        
        <!-- æ¸¸æˆç®¡ç†é¢æ¿ -->
        <div class="admin-panel">
            <h2>â• æ·»åŠ æ–°æ¸¸æˆ</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="gameName">æ¸¸æˆåç§° *</label>
                    <input type="text" id="gameName" placeholder="è¯·è¾“å…¥æ¸¸æˆåç§°" required>
                </div>
                <div class="form-group">
                    <label for="gameImageUrl">å›¾ç‰‡é“¾æ¥ *</label>
                    <input type="url" id="gameImageUrl" placeholder="è¯·è¾“å…¥å›¾ç‰‡URL" required>
                </div>
                <div class="form-group">
                    <label for="gameFormat">å†…å®¹å½¢å¼ *</label>
                    <select id="gameFormat" required>
                        <option value="ä»…æ•°å­—ç‰ˆ">ä»…æ•°å­—ç‰ˆ</option>
                        <option value="æ•°å­—ç‰ˆ&å…‰ç›˜">æ•°å­—ç‰ˆ&å…‰ç›˜</option>
                        <option value="ä»…å…‰ç›˜">ä»…å…‰ç›˜</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="gameTag">è‡ªå®šä¹‰æ ‡ç­¾ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="text" id="gameTag" placeholder="å¦‚ï¼šå¿…ç©ã€æ‰“æŠ˜ã€ç»å…¸">
                </div>
                <div class="form-group">
                    <label for="gameLink">è¶…é“¾æ¥ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="url" id="gameLink" placeholder="https://www.example.com">
                </div>
            </div>
            
            <div class="form-grid" style="margin-top: 10px;">
                <div class="form-group checkbox-group">
                    <input type="checkbox" id="gameNewRelease">
                    <label for="gameNewRelease">æ ‡è®°ä¸ºå³å°†ä¸Šæ–°æ¸¸æˆ</label>
                </div>
            </div>
            
            <div class="form-group" style="margin-top: 10px;">
                <label for="gameReleaseDate">å‘å”®æ—¥æœŸï¼ˆä»…å³å°†ä¸Šæ–°æ¸¸æˆéœ€è¦ï¼‰</label>
                <input type="date" id="gameReleaseDate">
            </div>
            
            <div class="form-actions">
                <button class="btn btn-primary" onclick="addGame()">â• æ·»åŠ æ¸¸æˆ</button>
                <button class="btn btn-secondary" onclick="clearAddForm()">ğŸ”„ æ¸…ç©ºè¡¨å•</button>
            </div>
        </div>
        
        <!-- çŠ¶æ€æç¤º -->
        <div id="status"></div>
        
        <!-- æ¸¸æˆåˆ—è¡¨ -->
        <div class="games-section">
            <h2>ğŸ® æ¸¸æˆåˆ—è¡¨ï¼ˆå…±<span id="gameCount">0</span>ä¸ªæ¸¸æˆï¼‰</h2>
            <div id="gamesContainer" class="games-container"></div>
        </div>
        
        <!-- æ•°æ®å¯¼å‡º -->
        <div class="export-section">
            <button class="btn btn-export" onclick="exportDataFunc()">ğŸ’¾ å¯¼å‡ºæ•°æ®åˆ° games.json</button>
        </div>
        
        <!-- å³å°†ä¸Šæ–°ç®¡ç†å·¥å…· -->
        <div class="export-section" style="margin-top: 15px;">
            <button class="btn" style="background-color: #e74c3c;" onclick="window.location.href='reset-new-releases.html'">ğŸ”„ é‡ç½®æ‰€æœ‰"å³å°†ä¸Šæ–°"æ ‡è®°</button>
        </div>
    </div>
    
    <!-- ç¼–è¾‘å¼¹çª— -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>âœï¸ ç¼–è¾‘æ¸¸æˆ</h3>
                <button class="close-modal" onclick="closeEditModal()">Ã—</button>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="editName">æ¸¸æˆåç§° *</label>
                    <input type="text" id="editName" required>
                </div>
                <div class="form-group">
                    <label for="editImage">å›¾ç‰‡é“¾æ¥ *</label>
                    <input type="url" id="editImage" required>
                </div>
                <div class="form-group">
                    <label for="editFormat">å†…å®¹å½¢å¼ *</label>
                    <select id="editFormat" required>
                        <option value="ä»…æ•°å­—ç‰ˆ">ä»…æ•°å­—ç‰ˆ</option>
                        <option value="æ•°å­—ç‰ˆ&å…‰ç›˜">æ•°å­—ç‰ˆ&å…‰ç›˜</option>
                        <option value="ä»…å…‰ç›˜">ä»…å…‰ç›˜</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editTag">è‡ªå®šä¹‰æ ‡ç­¾</label>
                    <input type="text" id="editTag" placeholder="å¦‚ï¼šå¿…ç©ã€æ‰“æŠ˜">
                </div>
                <div class="form-group">
                    <label for="editLink">è¶…é“¾æ¥</label>
                    <input type="url" id="editLink" placeholder="https://www.example.com">
                </div>
            </div>
            
            <div class="form-grid" style="margin-top: 10px;">
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="editNewRelease">
                        <label for="editNewRelease">æ ‡è®°ä¸ºå³å°†ä¸Šæ–°æ¸¸æˆ</label>
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 10px;">
                    <label for="editReleaseDate">å‘å”®æ—¥æœŸï¼ˆä»…å³å°†ä¸Šæ–°æ¸¸æˆéœ€è¦ï¼‰</label>
                    <input type="date" id="editReleaseDate">
                </div>
            
            <div class="form-actions" style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="saveEdit()">ğŸ’¾ ä¿å­˜ä¿®æ”¹</button>
                <button class="btn btn-warning" onclick="closeEditModal()">âŒ å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    
    <!-- è¿”å›æŒ‰é’® -->
    <button class="back-button" onclick="window.location.href='index.html'">ğŸ </button>
    
    <script src="script.js"></script>
    
    <script>
        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', async function() {
            // å¼ºåˆ¶è®¾ç½®ä¸ºç®¡ç†å‘˜æ¨¡å¼
            isAdmin = true;
            
            // åŠ è½½æ•°æ®
            const loadSuccess = await loadData();
            if (loadSuccess) {
                filterAndSort();
                setupDragSort();
                // ç¡®ä¿æ¸¸æˆåˆ—è¡¨è¢«æ­£ç¡®æ¸²æŸ“
                renderGames(games);
                document.getElementById("gameCount").textContent = games.length;
            }
        });
        
        // è¦†ç›–å…±ç”¨çš„filterAndSortå‡½æ•°ï¼Œç¡®ä¿åœ¨ç®¡ç†é¡µé¢æ¸²æŸ“æ‰€æœ‰æ¸¸æˆ
        function filterAndSort() {
            const query = document.getElementById("searchInput")?.value.trim().toLowerCase() || '';
            const sort = document.getElementById("sortSelect")?.value || 'default';

            let filtered = [...games];
            
            if (query) {
                filtered = filtered.filter(g => g.name.toLowerCase().includes(query));
            }

            if (sort === 'name-asc') {
                filtered.sort((a, b) => a.name.localeCompare(b.name));
            } else if (sort === 'name-desc') {
                filtered.sort((a, b) => b.name.localeCompare(a.name));
            } else if (sort === 'drag-sort') {
                // åº”ç”¨ä¿å­˜çš„æ‹–æ‹½æ’åº
                if (localStorage.getItem('dragSortOrder')) {
                    const dragSortOrder = JSON.parse(localStorage.getItem('dragSortOrder'));
                    filtered.sort((a, b) => {
                        const indexA = dragSortOrder.indexOf(a.id);
                        const indexB = dragSortOrder.indexOf(b.id);
                        if (indexA === -1 && indexB === -1) return 0;
                        if (indexA === -1) return 1;
                        if (indexB === -1) return -1;
                        return indexA - indexB;
                    });
                } else {
                    // å¦‚æœæ²¡æœ‰ä¿å­˜çš„æ’åºï¼Œåˆ™ä½¿ç”¨é»˜è®¤æ’åº
                    if (document.getElementById("sortSelect")) {
                        document.getElementById("sortSelect").value = "default";
                    }
                }
            }

            filteredGames = filtered;
            // åœ¨ç®¡ç†é¡µé¢ç›´æ¥æ¸²æŸ“æ‰€æœ‰æ¸¸æˆï¼Œè€Œä¸æ˜¯ä½¿ç”¨loadMore
            renderGames(filtered);
        }
        
        // ç¼–è¾‘å…¬å‘Š
        function editAnnouncement() {
            const current = document.getElementById("announcementText").innerText.trim();
            const newAnnounce = prompt("ç¼–è¾‘å…¬å‘Šå†…å®¹ï¼š", current);
            if (newAnnounce !== null && newAnnounce.trim() !== '') {
                document.getElementById("announcementText").innerText = newAnnounce.trim();
            }
        }
        
        // æ·»åŠ æ¸¸æˆ
        function addGame() {
            const name = document.getElementById("gameName").value.trim();
            const image = document.getElementById("gameImageUrl").value.trim();
            const format = document.getElementById("gameFormat").value;
            const tag = document.getElementById("gameTag").value.trim();
            const link = document.getElementById("gameLink").value.trim();
            const newRelease = document.getElementById("gameNewRelease").checked;
            const releaseDate = document.getElementById("gameReleaseDate").value;

            if (!name || !image || !format) {
                alert("è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼");
                return;
            }

            if (isDuplicate(name, games)) {
                if (!confirm(`âš ï¸ æ£€æµ‹åˆ°å¯èƒ½é‡å¤ï¼šâ€œ${name}â€\nç¡®å®šè¦ç»§ç»­æ·»åŠ å—ï¼Ÿ`)) return;
            }

            // æ„å»ºæ¸¸æˆå¯¹è±¡
            const gameData = { id: generateId(), name, image, format, tag, link, newRelease };
            
            // å¦‚æœæ ‡è®°ä¸ºå³å°†ä¸Šæ–°å¹¶ä¸”æœ‰å‘å”®æ—¥æœŸï¼Œåˆ™æ·»åŠ å‘å”®æ—¥æœŸå­—æ®µ
            if (newRelease && releaseDate) {
                gameData.releaseDate = releaseDate;
            }
            
            games.push(gameData);
            
            // ç›´æ¥è°ƒç”¨adminé¡µé¢çš„renderGameså‡½æ•°ï¼Œç¡®ä¿æ–°å¢æ¸¸æˆæ­£ç¡®æ˜¾ç¤º
            const container = document.getElementById("gamesContainer");
            if (container) {
                container.innerHTML = "";
                renderGames(games);
            }
            
            clearAddForm();
            document.getElementById("gameCount").textContent = games.length;
            
            // ä¿å­˜æ•°æ®åˆ°localStorage
            saveData();
        }
        
        // ä¿å­˜æ•°æ®åˆ°localStorageå’Œgames.json
        function saveData() {
            const announceText = document.getElementById("announcementText").innerText.trim();
            
            // é¦–å…ˆä¿å­˜åˆ°localStorage
            localStorage.setItem('gamesData', JSON.stringify({
                announcement: announceText,
                games: games
            }));
            
            // ç„¶åä¹Ÿä¿å­˜åˆ°games.jsonæ–‡ä»¶ï¼Œç¡®ä¿åˆ·æ–°é¡µé¢åæ•°æ®ä¾ç„¶å­˜åœ¨
            // è¿™é‡Œé€šè¿‡å°†æ•°æ®ä¸‹è½½ä¸ºæ–‡ä»¶çš„æ–¹å¼æä¾›ä¿å­˜é€‰é¡¹
            const dataStr = JSON.stringify({
                announcement: announceText,
                games: games
            }, null, 2);
            
            // æç¤ºç”¨æˆ·ä¿å­˜æ›´æ”¹åˆ°æ–‡ä»¶
            if (confirm('æ¸¸æˆæ•°æ®å·²æˆåŠŸä¿å­˜åˆ°æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ã€‚\n\nå¦‚æœæ‚¨æƒ³ç¡®ä¿æ•°æ®æ°¸ä¹…ä¿å­˜ï¼Œè¯·ç‚¹å‡»ç¡®å®šä¸‹è½½games.jsonæ–‡ä»¶å¹¶æ›¿æ¢åŸæ–‡ä»¶ã€‚')) {
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                const exportFileDefaultName = 'games.json';
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            }
        }
        
        // ç¼–è¾‘
        function openEditModal(index) {
            editingIndex = index;
            const game = games[index];
            document.getElementById("editName").value = game.name;
            document.getElementById("editImage").value = game.image;
            document.getElementById("editFormat").value = game.format;
            document.getElementById("editTag").value = game.tag || '';
            document.getElementById("editLink").value = game.link || '';
            document.getElementById("editNewRelease").checked = game.newRelease || false;
            document.getElementById("editReleaseDate").value = game.releaseDate || '';
            document.getElementById("editModal").style.display = "flex";
        }
        
        function saveEdit() {
            const name = document.getElementById("editName").value.trim();
            const image = document.getElementById("editImage").value.trim();
            const format = document.getElementById("editFormat").value;
            const tag = document.getElementById("editTag").value.trim();
            const link = document.getElementById("editLink").value.trim();
            const newRelease = document.getElementById("editNewRelease").checked;
            const releaseDate = document.getElementById("editReleaseDate").value;

            if (!name || !image || !format) {
                alert("è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼");
                return;
            }

            // ä¿ç•™åŸæœ‰id
            const id = games[editingIndex].id;
            
            // æ„å»ºæ¸¸æˆå¯¹è±¡
            const gameData = { id, name, image, format, tag, link, newRelease };
            
            // å¦‚æœæ ‡è®°ä¸ºå³å°†ä¸Šæ–°å¹¶ä¸”æœ‰å‘å”®æ—¥æœŸï¼Œåˆ™æ·»åŠ å‘å”®æ—¥æœŸå­—æ®µ
            if (newRelease && releaseDate) {
                gameData.releaseDate = releaseDate;
            } else {
                // å¦‚æœå–æ¶ˆæ ‡è®°ä¸ºå³å°†ä¸Šæ–°ï¼Œåˆ é™¤å‘å”®æ—¥æœŸå­—æ®µ
                delete gameData.releaseDate;
            }
            
            games[editingIndex] = gameData;
            filterAndSort();
            closeEditModal();
        }
        
        function closeEditModal() {
            document.getElementById("editModal").style.display = "none";
            editingIndex = null;
        }
        
        function deleteGame(index) {
            if (confirm(`ç¡®å®šåˆ é™¤ã€Š${games[index].name}ã€‹ï¼Ÿ`)) {
                games.splice(index, 1);
                filterAndSort();
                document.getElementById("gameCount").textContent = games.length;
                saveData(); // ç¡®ä¿åˆ é™¤åç«‹å³ä¿å­˜æ•°æ®
            }
        }
        
        function clearAddForm() {
            document.getElementById("gameName").value = "";
            document.getElementById("gameImageUrl").value = "";
            document.getElementById("gameFormat").value = "ä»…æ•°å­—ç‰ˆ";
            document.getElementById("gameTag").value = "";
            document.getElementById("gameLink").value = "";
            document.getElementById("gameNewRelease").checked = false;
        }
        
        // è¦†ç›–å…±ç”¨çš„renderGameså‡½æ•°ï¼Œåªç”¨äºç®¡ç†é¡µé¢
        function renderGames(gamesToRender) {
            const container = document.getElementById("gamesContainer");
            if (!container) return;
            
            container.innerHTML = "";

            gamesToRender.forEach((game, index) => {
                const card = document.createElement("div");
                card.className = "game-card";
                card.draggable = true;
                card.dataset.id = game.id;
                
                // æ·»åŠ æ‹–æ‹½ç›¸å…³çš„ç±»å
                card.addEventListener('dragstart', function() {
                    this.classList.add('dragging');
                });
                
                card.addEventListener('dragend', function() {
                    this.classList.remove('dragging');
                    // ç§»é™¤æ‰€æœ‰drag-overç±»
                    document.querySelectorAll('.game-card.drag-over').forEach(el => {
                        el.classList.remove('drag-over');
                    });
                });
                
                card.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    // ç§»é™¤å…¶ä»–å¡ç‰‡çš„drag-overç±»
                    document.querySelectorAll('.game-card.drag-over').forEach(el => {
                        el.classList.remove('drag-over');
                    });
                    // ä¸ºå½“å‰å¡ç‰‡æ·»åŠ drag-overç±»
                    this.classList.add('drag-over');
                });
                
                card.addEventListener('dragleave', function() {
                    this.classList.remove('drag-over');
                });

                let badgesHtml = '';
                if (game.newRelease) badgesHtml += '<div class="new-release-badge">å³å°†ä¸Šæ–°</div>';
                const tagHtml = game.tag ? `<div class="game-tag">${game.tag}</div>` : '';

                // ä¸ºæ¸¸æˆåç§°æ·»åŠ 'ä¸Šæ–°'æ ‡ç­¾
                const newReleaseTag = game.newRelease ? '<span style="display: inline-block; margin-left: 8px; padding: 2px 6px; background-color: #e74c3c; color: white; border-radius: 4px; font-size: 12px; font-weight: normal;">ä¸Šæ–°</span>' : '';
                
                card.innerHTML = `
                    <div class="game-image-container">
                        <img src="${game.image}" alt="${game.name}" class="game-image" onerror="this.src='data:image/svg+xml;charset=UTF-8,%3csvg xmlns%3d%22http%3a%2f%2fwww.w3.org%2f2000%2fsvg%22 width%3d%22140%22 height%3d%22100%22 viewBox%3d%220 0 140 100%22 fill%3d%22none%22%3e%3crect width%3d%22140%22 height%3d%22100%22 fill%3d%22%23f0f0f0%22%2f%3e%3ctext x%3d%2270%22 y%3d%2250%22 dominant-baseline%3d%22middle%22 text-anchor%3d%22middle%22 font-family%3d%22Arial%22 font-size%3d%2210%22 fill%3d%22%23666%22%3e${encodeURIComponent(game.name)}%3c%2ftext%3e%3c%2fsvg%3e'">
                        ${badgesHtml}
                        ${tagHtml}
                    </div>
                    <div class="game-info">
                        <h3 class="game-title">${game.name}${newReleaseTag}</h3>
                        <p class="game-format">${game.format}</p>
                    ${game.releaseDate ? `<p style="color: #e67e22; font-size: 12px; margin-top: 4px;">å‘å”®æ—¥æœŸï¼š${game.releaseDate}</p>` : ''}
                    <div class="card-actions">
                            <button class="btn btn-edit" onclick="openEditModal(${index})">ç¼–è¾‘</button>
                            <button class="btn btn-delete" onclick="deleteGame(${index})">åˆ é™¤</button>
                        </div>
                    </div>
                `;

                container.appendChild(card);
            });
        }
    </script>
</body>
</html>